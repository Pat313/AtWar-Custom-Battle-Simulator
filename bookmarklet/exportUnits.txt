javascript:(function(){
    const unitBucketsObj = atWar.Static.GameModule.$3$UnitsField.buckets;
    const unitArray = Object.keys(unitBucketsObj)
        .map(k=>unitBucketsObj[k][0])
        .filter(u=>u&&u.value);
    const unitIdNameMap = {};
    unitArray.forEach(u=>{
        const v=u.value;
        unitIdNameMap[v.Id]=v.Name;
    });
    const roleBucketsObj = atWar.Static.GameModule.$3$UnitRolesField.buckets;
    const unitRolesArray=Object.keys(roleBucketsObj).map(k=>roleBucketsObj[k][0]).filter(u=>u&&u.value);
    const idNameMap={};
    unitRolesArray.forEach(u=>{
        const v=u.value;
        const normalizedName=v.Name.toLowerCase().replace(/:/g,'').replace(/\s+/g,'_');
        idNameMap[v.Id]=normalizedName;
    });
    const mapId=atWar.Static.GameModule.MapData.Id;
    const extractedUnits={};
    unitArray.forEach(u=>{
        const v=u.value;
        const defBonusList=(v.UnitDefenceList||[]).filter(d=>d.AttackingUnitId!==0).map(d=>({unit_id:unitIdNameMap[d.AttackingUnitId]||d.AttackingUnitId.toString(),defbonus:d.DefenceBonus}));
        const unitRoleName=idNameMap[v.UnitRoleId]||v.UnitRoleId;
        extractedUnits[v.Name]={image:`https://atwar-game.com/games/getimage.php?url=maps/map-${mapId}/units/${v.Id}.jpg`,max_attack:v.MaxAttack,max_defence:v.MaxDefence,hp:v.HitPoints,crit:v.Crit,unit_role_id:unitRoleName,defbonus:defBonusList};
    });
    const fileName=atWar.Static.GameModule.MapData.CreatorName+' - '+atWar.Static.GameModule.MapData.Name;
    const fileContent='window.units='+JSON.stringify(extractedUnits,null,4)+';';
    const blob=new Blob([fileContent],{type:'text/javascript'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download=fileName+'.js';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
})();
